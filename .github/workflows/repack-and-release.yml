name: Release HDL Batch Installer
on:
  workflow_dispatch:
  push:
#    paths:
#      - '.github/workflows/repack-and-release.yml'

#  schedule:
#   - cron: "0 15 * * 5,2"
jobs:

  Repack_and_Release:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package: [English, Spanish]
    steps:

    - name: checkout code for release
      uses: actions/checkout@v1
      
      
      
    - name: Update Widescreen Hacks Package
      run: |
        cd HDD_ART_Batcher
        cd BAT
        rm -f WIDE.ZIP
        wget https://github.com/madmodder123/OpenPS2Loader_Widescreen_Cheats/archive/refs/heads/master.zip -O $PWD/WIDE.ZIP
    - name: Zip Folder
      run: |
        SCH=${GITHUB_SHA::7}
        PKG=${{ matrix.package }}
        
        cd HDD_ART_Batcher
        cd BAT
        echo commit $SCH>commit.sys
        echo `date`>>commit.sys
        rm -f LANG2.BAT
        cd LANGUAGES
        cp $PKG.BAT ../LANG2.BAT
        cd ..
        cd ..
        cd ..
        DATEE=`date '+[%Y-%m-%d]'`
        mv HDD_ART_Batcher HDD_ART_BATCHER-$PKG-$DATEE
        zip -r HDD_Art_Batcher\[$SCH\] HDD_ART_BATCHER-$PKG-*/*
        ls -R
    - name: Upload artifacts
      if: ${{ success() }}
      uses: actions/upload-artifact@v2
      with:
        name:  ${{ matrix.package }}
        path: |
             HDD_Art_Batcher*.zip
    - name: Create release
      if: github.ref == 'refs/heads/master' || github.ref == 'refs/heads/main'
      uses: marvinpinto/action-automatic-releases@latest
      with:
        repo_token: "${{ secrets.GITHUB_TOKEN }}"
        automatic_release_tag: ${{ matrix.package }}
        title:  " HDD Art Batcher ${{ matrix.package }}"
        files: |
                HDD_Art_Batcher*.zip
